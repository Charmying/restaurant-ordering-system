<div class="min-h-screen bg-[rgb(var(--surface))]">
  <header class="bg-[rgb(var(--surface-elevated))]/80 backdrop-blur-2xl border-b border-[rgb(var(--border))]/60 shadow-sm">
    <div class="px-3 sm:px-4 lg:px-6 py-2 sm:py-3 lg:py-4">
      <div class="flex flex-col gap-2 sm:gap-3">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <div class="space-y-0.5">
            <h1 class="text-lg sm:text-xl lg:text-2xl font-semibold tracking-tight text-[rgb(var(--text-primary))]">
              {{ 'features.userManagement.title' | translate }}
            </h1>
            <p class="text-xs text-[rgb(var(--text-secondary))] font-medium">
              {{ 'features.userManagement.subtitle' | translate }}
            </p>
          </div>
          @if (canManageUsers()) {
            <button (click)="openAddUserModal()"
              class="px-4 py-2 bg-[rgb(var(--accent))] text-white rounded-lg sm:rounded-xl hover:bg-[rgb(var(--accent))]/90 transition-all text-sm font-semibold shadow-md">
              {{ 'features.userManagement.actions.add' | translate }}
            </button>
          }
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-1.5 sm:gap-2 lg:gap-3">
          <div class="bg-[rgb(var(--surface))]/60 backdrop-blur-sm rounded-lg p-1.5 sm:p-2 lg:p-3 border border-[rgb(var(--border))]/50 transition-all duration-500 hover:shadow-lg hover:scale-[1.02] hover:bg-[rgb(var(--surface))]/80">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs font-medium text-[rgb(var(--text-secondary))]">
                  {{ 'features.userManagement.stats.total' | translate }}
                </p>
                <p class="text-sm sm:text-base lg:text-lg font-bold text-[rgb(var(--text-primary))] mt-0.5">
                  {{ stats().total }}
                </p>
              </div>
              <div class="w-4 h-4 sm:w-6 sm:h-6 lg:w-8 lg:h-8 bg-[rgb(var(--surface-muted))]/50 rounded-lg flex items-center justify-center">
                <svg class="w-2 h-2 sm:w-3 sm:h-3 lg:w-4 lg:h-4 text-[rgb(var(--text-secondary))]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5s-3 1.343-3 3 1.343 3 3 3zm0 2c-2.761 0-5 1.567-5 3.5V19h10v-2.5c0-1.933-2.239-3.5-5-3.5z"></path>
                </svg>
              </div>
            </div>
          </div>
          <div class="bg-[rgb(var(--surface))]/60 backdrop-blur-sm rounded-lg p-1.5 sm:p-2 lg:p-3 border border-[rgb(var(--border))]/50 transition-all duration-500 hover:shadow-lg hover:scale-[1.02] hover:bg-[rgb(var(--surface))]/80">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs font-medium text-[rgb(var(--text-secondary))]">
                  {{ 'features.userManagement.stats.managers' | translate }}
                </p>
                <p class="text-sm sm:text-base lg:text-lg font-bold text-[rgb(var(--text-primary))] mt-0.5">
                  {{ stats().managers }}
                </p>
              </div>
              <div class="w-4 h-4 sm:w-6 sm:h-6 lg:w-8 lg:h-8 bg-green-100 rounded-lg flex items-center justify-center">
                <svg class="w-2 h-2 sm:w-3 sm:h-3 lg:w-4 lg:h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4M12 6a6 6 0 100 12 6 6 0 000-12z"></path>
                </svg>
              </div>
            </div>
          </div>
          <div class="bg-[rgb(var(--surface))]/60 backdrop-blur-sm rounded-lg p-1.5 sm:p-2 lg:p-3 border border-[rgb(var(--border))]/50 transition-all duration-500 hover:shadow-lg hover:scale-[1.02] hover:bg-[rgb(var(--surface))]/80">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs font-medium text-[rgb(var(--text-secondary))]">
                  {{ 'features.userManagement.stats.employees' | translate }}
                </p>
                <p class="text-sm sm:text-base lg:text-lg font-bold text-[rgb(var(--text-primary))] mt-0.5">
                  {{ stats().employees }}
                </p>
              </div>
              <div class="w-4 h-4 sm:w-6 sm:h-6 lg:w-8 lg:h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                <svg class="w-2 h-2 sm:w-3 sm:h-3 lg:w-4 lg:h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10a4 4 0 108 0 4 4 0 00-8 0zm-4 10c0-3.314 2.686-6 6-6h4c3.314 0 6 2.686 6 6"></path>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <main class="px-2 sm:px-3 lg:px-4 py-3 sm:py-4 lg:py-6">
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
      @for (user of users(); track user._id) {
        <div class="bg-[rgb(var(--surface))] border border-[rgb(var(--border))]/60 rounded-2xl p-5 sm:p-6 space-y-4"
          [class.border-blue-400]="user._id === currentUser._id">
          <div>
            <div class="flex items-center gap-2">
              <h3 class="text-base sm:text-lg font-semibold text-[rgb(var(--text-primary))]">
                {{ user.username }}
              </h3>
              @if (user._id === currentUser._id) {
                <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-medium">
                  {{ 'features.userManagement.badges.me' | translate }}
                </span>
              }
            </div>
            <span class="inline-block mt-2 px-3 py-1 rounded-full text-sm font-medium" [class]="getRoleClasses(user.role)">
              {{ getRoleName(user.role) }}
            </span>
          </div>
          @if (canEditUsername(user) || canChangePassword(user) || canDeleteUser(user)) {
            <div class="space-y-2">
              @if (canEditUsername(user)) {
                <button (click)="openEditUsernameModal(user)"
                  class="w-full px-4 py-2 bg-[rgb(var(--surface-muted))] text-[rgb(var(--text-primary))] rounded-xl hover:bg-[rgb(var(--surface-elevated))] transition-all text-sm font-medium">
                  {{ 'features.userManagement.actions.editUsername' | translate }}
                </button>
              }
              @if (canChangePassword(user)) {
                <button (click)="openChangePasswordModal(user)"
                  class="w-full px-4 py-2 bg-blue-100 text-blue-600 rounded-xl hover:bg-blue-200 transition-all text-sm font-medium">
                  {{ 'features.userManagement.actions.changePassword' | translate }}
                </button>
              }
              @if (canDeleteUser(user)) {
                <button (click)="deleteUser(user)"
                  class="w-full px-4 py-2 bg-[rgb(var(--destructive-bg))] text-[rgb(var(--destructive))] rounded-xl hover:opacity-80 transition-smooth text-sm font-medium">
                  {{ 'features.userManagement.actions.delete' | translate }}
                </button>
              }
            </div>
          }
        </div>
      }
    </div>
    @if (!users().length) {
      <div class="text-center py-10 text-[rgb(var(--text-secondary))]">
        {{ 'features.userManagement.emptyState' | translate }}
      </div>
    }
  </main>
  @if (showAddUserModal) {
    <app-modal (close)="closeAddUserModal()" maxHeight="auto">
      <div class="p-6 sm:p-8 space-y-6 bg-[rgb(var(--surface))]/60 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <h3 class="text-xl sm:text-2xl font-semibold text-[rgb(var(--text-primary))]">
            {{ 'features.userManagement.modal.addTitle' | translate }}
          </h3>
          <button (click)="closeAddUserModal()"
            class="p-1.5 sm:p-2 rounded-full hover:bg-[rgb(var(--surface-muted))] transition-all">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-[rgb(var(--text-secondary))]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-[rgb(var(--text-secondary))] mb-2">
              {{ 'features.userManagement.form.username' | translate }}
            </label>
            <input type="text"
              class="w-full px-4 py-3 rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--surface))] text-[rgb(var(--text-primary))] placeholder-[rgb(var(--text-secondary))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--accent))]"
              [(ngModel)]="userForm.username"
              [placeholder]="'features.userManagement.form.usernamePlaceholder' | translate">
          </div>
          <div>
            <label class="block text-sm font-medium text-[rgb(var(--text-secondary))] mb-2">
              {{ 'features.userManagement.form.password' | translate }}
            </label>
            <input type="password"
              class="w-full px-4 py-3 rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--surface))] text-[rgb(var(--text-primary))] placeholder-[rgb(var(--text-secondary))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--accent))]"
              [(ngModel)]="userForm.password"
              [placeholder]="'features.userManagement.form.passwordPlaceholder' | translate">
          </div>
          <div>
            <label class="block text-sm font-medium text-[rgb(var(--text-secondary))] mb-2">
              {{ 'features.userManagement.form.role' | translate }}
            </label>
            <select class="no-arrow-select w-full px-4 py-3 rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--surface))] text-[rgb(var(--text-primary))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--accent))]"
              [(ngModel)]="userForm.role">
              @for (role of availableRoles; track role) {
                <option [value]="role">
                  {{ getRoleName(role) }}
                </option>
              }
            </select>
          </div>
        </div>
        <div class="flex gap-3">
          <button (click)="closeAddUserModal()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--surface-muted))] text-[rgb(var(--text-primary))] rounded-xl hover:bg-[rgb(var(--surface-elevated))] transition-all font-semibold">
            {{ 'features.userManagement.actions.cancel' | translate }}
          </button>
          <button (click)="saveUser()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--accent))] text-white rounded-xl hover:bg-[rgb(var(--accent))]/90 transition-all font-semibold shadow-md">
            {{ 'features.userManagement.actions.save' | translate }}
          </button>
        </div>
      </div>
    </app-modal>
  }
  @if (showChangePasswordModal) {
    <app-modal (close)="closeChangePasswordModal()" maxHeight="auto">
      <div class="p-6 sm:p-8 space-y-6 bg-[rgb(var(--surface))]/60 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <h3 class="text-xl sm:text-2xl font-semibold text-[rgb(var(--text-primary))]">
            {{ 'features.userManagement.modal.changePasswordTitle' | translate }}
          </h3>
          <button (click)="closeChangePasswordModal()"
            class="p-1.5 sm:p-2 rounded-full hover:bg-[rgb(var(--surface-muted))] transition-all">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-[rgb(var(--text-secondary))]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div>
          <label class="block text-sm font-medium text-[rgb(var(--text-secondary))] mb-2">
            {{ 'features.userManagement.form.newPassword' | translate }}
          </label>
          <input type="password"
            class="w-full px-4 py-3 rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--surface))] text-[rgb(var(--text-primary))] placeholder-[rgb(var(--text-secondary))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--accent))]"
            [(ngModel)]="changePasswordForm.password"
            [placeholder]="'features.userManagement.form.newPasswordPlaceholder' | translate">
        </div>
        <div class="flex gap-3">
          <button (click)="closeChangePasswordModal()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--surface-muted))] text-[rgb(var(--text-primary))] rounded-xl hover:bg-[rgb(var(--surface-elevated))] transition-all font-semibold">
            {{ 'features.userManagement.actions.cancel' | translate }}
          </button>
          <button (click)="changePassword()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--accent))] text-white rounded-xl hover:bg-[rgb(var(--accent))]/90 transition-all font-semibold shadow-md">
            {{ 'features.userManagement.actions.confirm' | translate }}
          </button>
        </div>
      </div>
    </app-modal>
  }
  @if (showEditUsernameModal) {
    <app-modal (close)="closeEditUsernameModal()" maxHeight="auto">
      <div class="p-6 sm:p-8 space-y-6 bg-[rgb(var(--surface))]/60 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <h3 class="text-xl sm:text-2xl font-semibold text-[rgb(var(--text-primary))]">
            {{ 'features.userManagement.modal.editUsernameTitle' | translate }}
          </h3>
          <button (click)="closeEditUsernameModal()"
            class="p-1.5 sm:p-2 rounded-full hover:bg-[rgb(var(--surface-muted))] transition-all">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-[rgb(var(--text-secondary))]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div>
          <label class="block text-sm font-medium text-[rgb(var(--text-secondary))] mb-2">
            {{ 'features.userManagement.form.username' | translate }}
          </label>
          <input type="text"
            class="w-full px-4 py-3 rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--surface))] text-[rgb(var(--text-primary))] placeholder-[rgb(var(--text-secondary))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--accent))]"
            [(ngModel)]="editUsernameForm.username"
            [placeholder]="'features.userManagement.form.usernamePlaceholder' | translate">
        </div>
        <div class="flex gap-3">
          <button (click)="closeEditUsernameModal()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--surface-muted))] text-[rgb(var(--text-primary))] rounded-xl hover:bg-[rgb(var(--surface-elevated))] transition-all font-semibold">
            {{ 'features.userManagement.actions.cancel' | translate }}
          </button>
          <button (click)="saveUsername()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--accent))] text-white rounded-xl hover:bg-[rgb(var(--accent))]/90 transition-all font-semibold shadow-md">
            {{ 'features.userManagement.actions.save' | translate }}
          </button>
        </div>
      </div>
    </app-modal>
  }
</div>
  @if (showDeleteModal) {
    <app-modal (close)="closeDeleteModal()" maxHeight="auto">
      <div class="p-6 sm:p-8 space-y-6 bg-[rgb(var(--surface))]/60 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <h3 class="text-xl sm:text-2xl font-semibold text-[rgb(var(--text-primary))]">
            {{ 'features.userManagement.modal.deleteTitle' | translate }}
          </h3>
          <button (click)="closeDeleteModal()"
            class="p-1.5 sm:p-2 rounded-full hover:bg-[rgb(var(--surface-muted))] transition-all">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-[rgb(var(--text-secondary))]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <p class="text-sm text-[rgb(var(--text-secondary))]">
          {{ 'features.userManagement.confirmDelete' | translate: { username: userToDelete?.username } }}
        </p>
        <div class="flex gap-3">
          <button (click)="closeDeleteModal()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--surface-muted))] text-[rgb(var(--text-primary))] rounded-xl hover:bg-[rgb(var(--surface-elevated))] transition-all font-semibold">
            {{ 'features.userManagement.actions.cancel' | translate }}
          </button>
          <button (click)="confirmDelete()"
            class="flex-1 px-4 py-3 bg-[rgb(var(--destructive))] text-white rounded-xl hover:opacity-90 transition-all font-semibold">
            {{ 'features.userManagement.actions.delete' | translate }}
          </button>
        </div>
      </div>
    </app-modal>
  }
  @if (showAlertModal) {
    <app-modal (close)="closeAlertModal()" maxHeight="auto">
      <div class="p-6 sm:p-8 space-y-6 bg-[rgb(var(--surface))]/60 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <h3 class="text-xl sm:text-2xl font-semibold text-[rgb(var(--text-primary))]">
            {{ 'common.notification' | translate }}
          </h3>
          <button (click)="closeAlertModal()"
            class="p-1.5 sm:p-2 rounded-full hover:bg-[rgb(var(--surface-muted))] transition-all">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-[rgb(var(--text-secondary))]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <p class="text-sm text-[rgb(var(--text-secondary))]">
          {{ alertMessage }}
        </p>
        <div class="flex justify-end">
          <button (click)="closeAlertModal()"
            class="px-6 py-3 bg-[rgb(var(--accent))] text-white rounded-xl hover:bg-[rgb(var(--accent))]/90 transition-all font-semibold shadow-md">
            {{ 'common.ok' | translate }}
          </button>
        </div>
      </div>
    </app-modal>
  }
