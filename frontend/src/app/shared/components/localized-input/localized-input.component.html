<div class="space-y-3">
  @if (label) {
    <label [class]="getLabelClass()">
      {{ label }}
      @if (required) {
        <span class="text-[rgb(var(--destructive))]" aria-label="required">*</span>
      }
    </label>
  }
  <div class="flex gap-0 border-b border-[rgb(var(--border))]" role="tablist" aria-label="language-selection">
    @for (lang of languages(); track lang) {
      <button type="button" role="tab" (click)="switchLanguage(lang)" [disabled]="disabled"
        class="min-w-fit relative outline-none"
        [class]="getTabClass(lang)"
        [attr.aria-selected]="lang === activeTab()"
        [attr.aria-label]="languageLabels()[lang]">
        {{ languageLabels()[lang] }}
        @if (lang === activeTab()) {
          <div [class]="getIndicatorClass(lang)"></div>
        }
      </button>
    }
  </div>
  <div [class]="getInputWrapperClass()" role="group" [attr.aria-labelledby]="label ? 'input-label' : null">
    @if (inputType === 'text') {
      <input type="text" [disabled]="disabled"
        class="w-full px-4 py-2.5 bg-transparent text-[rgb(var(--text-primary))] placeholder-[rgb(var(--text-secondary))] outline-none transition-colors"
        [value]="currentValue()"
        (input)="onInputChange($any($event.target))"
        (focus)="onInputFocus()"
        (blur)="onInputBlur()"
        [placeholder]="getPlaceholder()"
        [attr.maxlength]="maxLength"
        [attr.aria-label]="'localization.language.' + activeTab()"
        [attr.aria-invalid]="hasError()"
        [attr.aria-describedby]="errorMessage ? 'error-message' : helpText ? 'help-text' : null" />
    }
    @if (inputType === 'textarea') {
      <textarea [disabled]="disabled"
        class="w-full px-4 py-2.5 bg-transparent text-[rgb(var(--text-primary))] placeholder-[rgb(var(--text-secondary))] outline-none resize-none transition-colors"
        [value]="currentValue()"
        (input)="onInputChange($any($event.target))"
        (focus)="onInputFocus()"
        (blur)="onInputBlur()"
        [placeholder]="getPlaceholder()"
        [rows]="rows"
        [attr.maxlength]="maxLength"
        [attr.aria-label]="'localization.language.' + activeTab()"
        [attr.aria-invalid]="hasError()"
        [attr.aria-describedby]="errorMessage ? 'error-message' : helpText ? 'help-text' : null"></textarea>
    }
  </div>
  @if (showCharacterCount() || errorMessage || helpText) {
    <div class="flex items-center justify-between gap-2">
      @if (errorMessage) {
        <span id="error-message" [class]="getHelpTextClass()" role="alert">
          {{ errorMessage | translate }}
        </span>
      } @else if (helpText) {
        <span id="help-text" [class]="getHelpTextClass()">
          {{ helpText | translate }}
        </span>
      } @else {
        <div></div>
      }
      @if (showCharacterCount()) {
        <span [class]="getCharacterCountClass()" class="text-xs font-medium whitespace-nowrap">
          {{ characterCount() }} / {{ maxLength }}
        </span>
      }
    </div>
  }
  <div class="mb-4 flex gap-1.5 flex-wrap">
    @for (lang of languages(); track lang) {
      <div class="flex items-center gap-1 px-2 py-1 rounded text-xs font-medium"
        [class.bg-[rgb(var(--surface-elevated))]]="!value()[lang]?.trim()"
        [class.bg-[rgb(var(--accent))]/10]="value()[lang]?.trim()"
        [style.color]="value()[lang]?.trim() ? 'rgb(var(--accent))' : 'rgb(var(--text-secondary))'">
        <span class="w-2 h-2 rounded-full" [class.bg-[rgb(var(--accent))]]="value()[lang]?.trim()" [class.bg-[rgb(var(--border))]]="!value()[lang]?.trim()"></span>
        {{ languageLabels()[lang] }}
      </div>
    }
  </div>
</div>
